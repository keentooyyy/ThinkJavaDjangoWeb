{% load static %}

<!DOCTYPE html>
<html lang="en" class="light-theme">
<head>
    <script>
        (function () {
            let savedTheme = localStorage.getItem("theme");

            if (savedTheme === "dark") {
                document.documentElement.className = "dark-theme";
            } else if (savedTheme === "light") {
                document.documentElement.className = "light-theme";
            } else {
                // Default to light if nothing saved, and persist it
                document.documentElement.className = "light-theme";
                localStorage.setItem("theme", "light");
            }
        })();

    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Think Java{% endblock %}</title>
    <link rel="icon" type="image/x-icon" href="{% static 'images/icons/Player.ico' %}">


    <!-- Plugins -->
    <link href="{% static 'plugins/notifications/css/lobibox.min.css' %}" rel="stylesheet"/>
    <link href="{% static 'plugins/simplebar/css/simplebar.css' %}" rel="stylesheet"/>
    <link href="{% static 'plugins/perfect-scrollbar/css/perfect-scrollbar.css' %}" rel="stylesheet"/>
    <link href="{% static 'plugins/highcharts/css/highcharts.css' %}" rel="stylesheet"/>
    <link href="{% static 'plugins/vectormap/jquery-jvectormap-2.0.2.css' %}" rel="stylesheet"/>
    <link href="{% static 'plugins/metismenu/css/metisMenu.min.css' %}" rel="stylesheet"/>
    <!-- Bootstrap CSS -->
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
    <link href="{% static 'css/bootstrap-extended.css' %}" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <link href="{% static 'css/app.css' %}" rel="stylesheet">
    <link href="{% static 'css/icons.css' %}" rel="stylesheet">
    <!-- Theme Style CSS -->
    <link rel="stylesheet" href="{% static 'css/dark-theme.css' %}"/>
    <link rel="stylesheet" href="{% static 'css/semi-dark.css' %}"/>
    <link rel="stylesheet" href="{% static 'css/header-colors.css' %}"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" rel="stylesheet">


</head>
<body>


<div class="wrapper">
    {% block sidebar %} {% endblock %}
    {% block header %}{% endblock %}
    {% block content %}{% endblock %}
    {% block footer %} {% endblock %}
</div>


<!-- jQuery first -->
<script src="{% static 'js/jquery.min.js' %}"></script>

<!-- Bootstrap JS -->
<script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>

<!-- Plugins -->
<script src="{% static 'plugins/simplebar/js/simplebar.min.js' %}"></script>
<script src="{% static 'plugins/metismenu/js/metisMenu.min.js' %}"></script>
<script src="{% static 'plugins/perfect-scrollbar/js/perfect-scrollbar.js' %}"></script>
<script src="{% static 'plugins/apexcharts-bundle/js/apexcharts.min.js' %}"></script>
<script src="{% static 'plugins/highcharts/js/highcharts.js' %}"></script>

<!-- App JS -->
<script src="{% static 'js/app.js' %}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>

{# Theme Init #}
<script>
    $(document).ready(function () {
        let savedTheme = localStorage.getItem("theme");

        if (savedTheme === "light") {
            $(".dark-mode-icon i").attr("class", "bx bx-moon");
        } else {
            $(".dark-mode-icon i").attr("class", "bx bx-sun");
        }
    });
</script>

{#  logout modal buttons confirmation  #}
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const yesBtn = document.getElementById("logoutConfirmModal_yes");
        if (yesBtn) {
            yesBtn.addEventListener("click", function () {
                window.location.href = "{% url 'unified_logout' %}";
            });
        }
    });
</script>



<script>
        $(document).ready(function () {
            // When any notification modal is closed
            $("[id^='notifModal']").on("hidden.bs.modal", function () {
                let notifUrl = $(this).data("notif-url");
                if (notifUrl) {
                    $.get(notifUrl)
                        .done(() => {
                            {#console.log("Notification marked as read");#}

                            // ðŸ”” Update badge count
                            let badge = $(".alert-count");
                            let count = parseInt(badge.text());
                            if (!isNaN(count) && count > 0) {
                                let newCount = count - 1;
                                badge.text(newCount > 9 ? "9+" : newCount);
                                if (newCount <= 0) badge.hide();
                            }

                            // ðŸ”” Remove bold class for this item
                            $("a[data-bs-target='#" + $(this).attr("id") + "']").removeClass("fw-bold");
                        });
                }
            });
        });
    </script>

    <script>
    $(document).ready(function () {
        $(".btn-delete-notif").on("click", function () {
            const notifId = $(this).data("notif-id");
            const $modal = $(this).closest(".modal");

            {#if (!confirm("Are you sure you want to delete this notification?")) return;#}

            $.ajax({
                url: `/notifications/delete/${notifId}/`,
                method: "POST",
                data: { csrfmiddlewaretoken: "{{ csrf_token }}" },
                success: function (res) {
                    if (res.success) {
                        // Remove from dropdown list
                        $(`#notifModal${notifId}`).modal("hide");
                        $(`#notifModal${notifId}`).remove();
                        $(`#notifContainer a[data-bs-target="#notifModal${notifId}"]`).remove();

                        // Optionally, update unread count
                        const currentCount = parseInt($(".alert-count").text()) || 0;
                        if (currentCount > 1) $(".alert-count").text(currentCount - 1);
                        else $(".alert-count").remove();

                        // Optional toast feedback
                        {#alert("Notification deleted successfully!");#}
                    }
                },
                error: function (xhr) {
                    alert(xhr.responseJSON?.error || "Error deleting notification.");
                },
            });
        });
    });
    </script>






{% block scripts %}


{% endblock %}

</body>

</html>
